<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gubby Clicker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* Basic palette + responsive scaling */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f8f8f8;
  color: #222;
  transition: background 0.3s ease;
}
body.multiplayer-mode {
  background: #eef6ff;
}
header {
  display: flex;
  justify-content: space-between;
  padding: 10px;
  background: #fff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
header h1 {
  font-size: clamp(18px, 2vw, 28px);
}
button {
  padding: 8px 14px;
  font-size: clamp(14px, 1.5vw, 18px);
  border: none;
  border-radius: 6px;
  cursor: pointer;
}
button.primary { background: #4cafef; color: white; }
button.danger { background: #e74c3c; color: white; }
#stats {
  display: flex;
  gap: 10px;
  padding: 10px;
}
.stat {
  flex: 1;
}
.progress {
  height: 20px;
  background: #ddd;
  border-radius: 10px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: #4cafef;
}
#shopModal, #chatModal {
  display: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
}
.modal-content {
  background: white;
  padding: 20px;
  width: 90%;
  max-width: 600px;
  max-height: 90%;
  overflow-y: auto;
  border-radius: 8px;
}
.shop-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 10px;
}
.shop-item {
  background: #fafafa;
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
  border-radius: 6px;
}
.shop-item.owned {
  background: #d4ffd4;
}
.chat-box {
  height: 300px;
  overflow-y: auto;
  background: #f0f0f0;
  padding: 8px;
  border: 1px solid #ccc;
}
.chat-input {
  display: flex;
  margin-top: 8px;
}
.chat-input input {
  flex: 1;
  padding: 6px;
}
.chat-input button {
  padding: 6px 12px;
}
</style>
</head>
<body>

<header>
  <h1>üêü Gubby Clicker</h1>
  <div id="authButtons">
    <button id="loginBtn" class="primary">Login</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
  </div>
</header>

<div id="stats">
  <div class="stat">
    Hunger
    <div class="progress"><div id="hungerBar" class="progress-fill" style="width:100%"></div></div>
  </div>
  <div class="stat">
    Thirst
    <div class="progress"><div id="thirstBar" class="progress-fill" style="width:100%"></div></div>
  </div>
  <div class="stat">
    Energy
    <div class="progress"><div id="energyBar" class="progress-fill" style="width:100%"></div></div>
  </div>
</div>

<div style="padding:10px;">
  <button id="feedBtn">Feed</button>
  <button id="drinkBtn">Give Water</button>
  <button id="restBtn">Rest</button>
  <button id="shopBtn">üõí Shop</button>
  <button id="hostBtn" class="primary">Host Game</button>
  <button id="joinBtn" class="primary">Join Game</button>
  <button id="chatBtn">üí¨ Chat</button>
  <button id="resetBtn" class="danger">Reset Room</button>
</div>

<div id="shopModal">
  <div class="modal-content">
    <h2>Shop</h2>
    <div id="shopItems" class="shop-grid"></div>
    <button onclick="closeShop()">Close</button>
  </div>
</div>

<div id="chatModal">
  <div class="modal-content">
    <h2>Room Chat</h2>
    <div id="chatMessages" class="chat-box"></div>
    <div class="chat-input">
      <input id="chatInput" placeholder="Type a message...">
      <button onclick="sendChat()">Send</button>
    </div>
    <button onclick="closeChat()">Close</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAai5V9VTtPnAdMoAhhVe94fobPOY25yf8",
  authDomain: "gubby-clicker.firebaseapp.com",
  projectId: "gubby-clicker",
  storageBucket: "gubby-clicker.firebasestorage.app",
  messagingSenderId: "255072290621",
  appId: "1:255072290621:web:9f80676beac50c0059a754",
  measurementId: "G-R3HFMPH5C4"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Game state
let hunger = 100, thirst = 100, energy = 100;
let roomCode = null;
let isHost = false;
let unsubscribeRoom = null;

// Shop data (shortened here for example ‚Äî can fill to 50+)
const shopItems = [
  { id: 'burger', name: 'üçî Burger', price: 10, desc: 'Fills hunger.' },
  { id: 'water', name: 'üíß Water Bottle', price: 5, desc: 'Fills thirst.' },
  { id: 'toy', name: 'üéæ Bouncy Ball', price: 20, desc: 'Keeps Gubby happy.' }
];

// UI Updates
function updateBars() {
  document.getElementById('hungerBar').style.width = hunger + '%';
  document.getElementById('thirstBar').style.width = thirst + '%';
  document.getElementById('energyBar').style.width = energy + '%';
}
updateBars();

// Auth
document.getElementById('loginBtn').onclick = () => {
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
};
document.getElementById('logoutBtn').onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById('loginBtn').style.display = 'none';
    document.getElementById('logoutBtn').style.display = 'inline-block';
  } else {
    document.getElementById('loginBtn').style.display = 'inline-block';
    document.getElementById('logoutBtn').style.display = 'none';
  }
});

// Shop functions
document.getElementById('shopBtn').onclick = () => {
  let shopContainer = document.getElementById('shopItems');
  shopContainer.innerHTML = '';
  shopItems.forEach(item => {
    let div = document.createElement('div');
    div.className = 'shop-item';
    div.innerHTML = `<strong>${item.name}</strong><br>${item.price} coins<br>${item.desc}<br><button>Buy</button>`;
    shopContainer.appendChild(div);
  });
  document.getElementById('shopModal').style.display = 'flex';
};
function closeShop() {
  document.getElementById('shopModal').style.display = 'none';
}

// Chat functions
document.getElementById('chatBtn').onclick = () => {
  document.getElementById('chatModal').style.display = 'flex';
};
function closeChat() {
  document.getElementById('chatModal').style.display = 'none';
}
function sendChat() {
  const msg = document.getElementById('chatInput').value;
  if (!roomCode || !msg) return;
  db.collection('rooms').doc(roomCode).update({
    messages: firebase.firestore.FieldValue.arrayUnion({
      uid: auth.currentUser.uid,
      name: auth.currentUser.displayName,
      text: msg,
      ts: Date.now()
    })
  });
  document.getElementById('chatInput').value = '';
}

// Hosting / Joining
document.getElementById('hostBtn').onclick = async () => {
  if (!auth.currentUser) return alert('Login first');
  roomCode = Math.random().toString(36).substr(2, 5).toUpperCase();
  isHost = true;
  await db.collection('rooms').doc(roomCode).set({
    state: { hunger, thirst, energy },
    members: [{ uid: auth.currentUser.uid, name: auth.currentUser.displayName }],
    shopOwned: [],
    messages: [],
    resetVotes: []
  });
  listenRoom(roomCode);
};
document.getElementById('joinBtn').onclick = () => {
  if (!auth.currentUser) return alert('Login first');
  const code = prompt('Enter room code:').toUpperCase();
  roomCode = code;
  db.collection('rooms').doc(code).update({
    members: firebase.firestore.FieldValue.arrayUnion({ uid: auth.currentUser.uid, name: auth.currentUser.displayName })
  });
  listenRoom(code);
};
function listenRoom(code) {
  if (unsubscribeRoom) unsubscribeRoom();
  unsubscribeRoom = db.collection('rooms').doc(code).onSnapshot(doc => {
    if (doc.exists) {
      const data = doc.data();
      hunger = data.state.hunger;
      thirst = data.state.thirst;
      energy = data.state.energy;
      updateBars();
      let chatBox = document.getElementById('chatMessages');
      chatBox.innerHTML = '';
      (data.messages || []).forEach(m => {
        let div = document.createElement('div');
        div.textContent = `${m.name}: ${m.text}`;
        chatBox.appendChild(div);
      });
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  });
}

// Reset
document.getElementById('resetBtn').onclick = async () => {
  if (!roomCode) return;
  const doc = await db.collection('rooms').doc(roomCode).get();
  const data = doc.data();
  const votes = new Set(data.resetVotes || []);
  votes.add(auth.currentUser.uid);
  await db.collection('rooms').doc(roomCode).update({ resetVotes: Array.from(votes) });
  if (votes.size === data.members.length) {
    await db.collection('rooms').doc(roomCode).update({
      state: { hunger: 100, thirst: 100, energy: 100 },
      shopOwned: [],
      messages: [],
      resetVotes: []
    });
  }
};
</script>
</body>
</html>
