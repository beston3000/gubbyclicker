<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raise a Gubby</title>
    <!-- 
    A NOTE ON FIRESTORE RULES
    These rules are essential for security and functionality.
    - They allow anyone to read/write to the 'rooms' collection, which is necessary for multiplayer.
    - They ensure that only logged-in users can create a user document for themselves.
    - A user can only update their own document.
    - The 'variants' collection is read-only for all users, so they can't cheat and change upgrade prices.
      Only you (from the server/console) or an admin (if you build that rule) should write to it.
      For the admin panel to work, we are adding a rule that allows users with the 'admin' privilege to write to the variants collection.

    THE RULES HAVE BEEN PROVIDED IN A SEPARATE DOCUMENT. PLEASE COPY THEM INTO YOUR FIRESTORE RULES EDITOR.
    -->
    <style>
        :root {
            --bg-color: #2c2f33;
            --secondary-bg: #23272a;
            --primary-text: #ffffff;
            --accent-color: #7289da;
            --accent-hover: #677bc4;
            --danger-color: #f04747;
            --success-color: #43b581;
            --warning-color: #faa61a;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --border-radius: 8px;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--primary-text);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        #app-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* --- AUTH & ROOMS --- */
        .screen {
            background-color: var(--secondary-bg);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 400px;
            text-align: center;
        }
        .screen h1 { margin-top: 0; }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold;}
        .form-group input {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            background-color: var(--bg-color);
            border: 1px solid #444;
            border-radius: var(--border-radius);
            color: var(--primary-text);
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: var(--accent-color);
            border: none;
            border-radius: var(--border-radius);
            color: var(--primary-text);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover { background-color: var(--accent-hover); }
        #google-login-btn {
            background-color: #4285F4;
            margin-top: 10px;
        }
        #google-login-btn:hover {
            background-color: #357ae8;
        }
        .toggle-link { margin-top: 20px; color: var(--accent-color); cursor: pointer; }
        .error-message { color: var(--danger-color); margin-top: 15px; min-height: 20px;}
        .divider {
            display: flex; align-items: center; text-align: center; margin: 20px 0;
        }
        .divider::before, .divider::after {
            content: ''; flex: 1; border-bottom: 1px solid #444;
        }
        .divider:not(:empty)::before { margin-right: .25em; }
        .divider:not(:empty)::after { margin-left: .25em; }

        /* --- GAME SCREEN --- */
        #game-screen {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        #game-canvas {
            background-color: #3a3f44;
            flex-grow: 1;
        }
        #hud {
            display: flex;
            justify-content: space-around;
            padding: 10px;
            background-color: var(--secondary-bg);
            flex-wrap: wrap;
        }
        .stat { display: flex; align-items: center; font-size: 1.2em; }
        .stat span { margin-left: 8px; }
        #controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background-color: var(--secondary-bg);
        }
        #controls button { width: auto; padding: 10px 20px;}
        #admin-panel-btn { background-color: var(--warning-color); }
        #logout-btn { background-color: var(--danger-color); }
        #day-night-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000030;
            opacity: 0;
            pointer-events: none;
            transition: opacity 2s ease-in-out;
        }

        /* --- MODALS --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: var(--secondary-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            width: 80%;
            max-width: 600px;
            position: relative;
        }
        .close-btn {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .shop-grid, .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .shop-item {
            background-color: var(--bg-color);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .shop-item img {
            width: 64px;
            height: 64px;
            object-fit: contain;
            margin: 0 auto 10px auto;
        }
        .shop-item button { width: 100%; font-size: 14px; padding: 8px;}

        /* --- GUBBY INFO --- */
        #gubby-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.5);
            padding: 10px 15px;
            border-radius: var(--border-radius);
        }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="app-container">

        <!-- AUTHENTICATION & ROOM SELECTION SCREEN -->
        <div id="auth-container" class="screen">
            <!-- Login Form -->
            <div id="login-form">
                <h1>Welcome Back!</h1>
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                <button id="login-btn">Login</button>
                <div class="divider">OR</div>
                <button id="google-login-btn">Sign in with Google</button>
                <div class="error-message" id="login-error"></div>
                <p class="toggle-link">Need an account? Sign Up</p>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="hidden">
                <h1>Create Account</h1>
                <div class="form-group">
                    <label for="signup-email">Email</label>
                    <input type="email" id="signup-email" required>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" required>
                </div>
                <button id="signup-btn">Sign Up</button>
                <div class="error-message" id="signup-error"></div>
                <p class="toggle-link">Already have an account? Login</p>
            </div>
            
            <!-- Room Selection (shown after login) -->
            <div id="room-selection" class="hidden">
                <h1>Join a Room</h1>
                <div class="form-group">
                    <label for="room-code-input">Enter Room Code</label>
                    <input type="text" id="room-code-input" placeholder="e.g., ABCDE">
                </div>
                <button id="join-room-btn">Join Room</button>
                <div class="divider">OR</div>
                <button id="create-room-btn">Create a New Room</button>
                <div class="error-message" id="room-error"></div>
            </div>
        </div>

        <!-- MAIN GAME SCREEN -->
        <div id="game-screen" class="hidden">
            <div id="gubby-info">
                <h2 id="gubby-name-display">Gubby</h2>
                <p>Room Code: <b id="room-code-display"></b></p>
            </div>
            <div id="day-night-overlay"></div>
            <canvas id="game-canvas"></canvas>
            <div id="hud">
                <div class="stat">üí∞ <span id="money-stat">0</span></div>
                <div class="stat">üçî <span id="hunger-stat">100</span>%</div>
                <div class="stat">üíß <span id="thirst-stat">100</span>%</div>
                <div class="stat">‚ö° <span id="energy-stat">100</span>%</div>
            </div>
            <div id="controls">
                <button id="feed-btn">Feed (Cost: 10)</button>
                <button id="water-btn">Water (Cost: 5)</button>
                <button id="shop-btn">Shop</button>
                <button id="admin-panel-btn" class="hidden">Admin Panel</button>
                <button id="logout-btn">Logout</button>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div id="name-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal-id="name-modal">&times;</span>
            <h2>Name Your Gubby!</h2>
            <div class="form-group">
                <label for="gubby-name-input">Gubby's Name</label>
                <input type="text" id="gubby-name-input" maxlength="20">
            </div>
            <button id="save-name-btn">Save Name</button>
        </div>
    </div>

    <div id="shop-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal-id="shop-modal">&times;</span>
            <h2>Shop</h2>
            <h3>Upgrades</h3>
            <div id="upgrades-grid" class="shop-grid">
                <!-- Upgrades will be populated by JS -->
            </div>
            <h3>Gubby Variants</h3>
            <div id="variants-grid" class="shop-grid">
                <!-- Variants will be populated by JS -->
            </div>
        </div>
    </div>
    
    <div id="admin-panel-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal-id="admin-panel-modal">&times;</span>
            <h2>Admin Panel: Add Gubby Variant</h2>
            <div class="form-group">
                <label for="variant-name">Variant Name (e.g., Water Gubby)</label>
                <input type="text" id="variant-name">
            </div>
            <div class="form-group">
                <label for="variant-filename">Sprite Filename (e.g., water.png)</label>
                <input type="text" id="variant-filename" placeholder="Must be in sprites/variants/">
            </div>
            <div class="form-group">
                <label for="variant-price">Price</label>
                <input type="number" id="variant-price" value="1000">
            </div>
            <div class="form-group">
                <label for="variant-multiplier">Click Multiplier</label>
                <input type="number" id="variant-multiplier" value="1.5" step="0.1">
            </div>
             <div class="form-group">
                <label for="variant-description">Description (e.g., Resists thirst)</label>
                <input type="text" id="variant-description">
            </div>
            <button id="add-variant-btn">Add Variant</button>
            <div class="error-message" id="admin-error"></div>
        </div>
    </div>

    <!-- Link to the external JavaScript file -->
    <script type="module" src="script.js"></script>

</body>
</html>
